<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UploadController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">testing</a> &gt; <a href="index.source.html" class="el_package">my.upm.emma.testing</a> &gt; <span class="el_source">UploadController.java</span></div><h1>UploadController.java</h1><pre class="source lang-java linenums">package my.upm.emma.testing;

import java.io.*;

import java.util.*;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.DocumentBuilder;
import org.w3c.dom.Document;
import org.w3c.dom.NodeList;
import org.w3c.dom.Node;
import org.w3c.dom.Element;


@Controller
<span class="nc" id="L23">public class UploadController {</span>

    @Autowired
    StorageService storageService;

<span class="nc" id="L28">    List&lt;String&gt; files = new ArrayList&lt;String&gt;();</span>


    @RequestMapping(
            value = (&quot;/post&quot;),
            headers = &quot;content-type=multipart/form-data&quot;,
            method = RequestMethod.POST)
    @CrossOrigin(origins = &quot;http://localhost:4200&quot;, allowedHeaders = &quot;*&quot;)
    @ResponseBody
    public ResponseEntity&lt;?&gt; handleFileUpload(@RequestParam(&quot;file&quot;) MultipartFile file) {
<span class="nc" id="L38">        String message = &quot;&quot;;</span>
        try {
<span class="nc" id="L40">            storageService.store(file);</span>
<span class="nc" id="L41">            files.add(file.getOriginalFilename());</span>

<span class="nc" id="L43">            message = &quot;You successfully uploaded &quot; + file.getOriginalFilename() + &quot;!&quot;;</span>
<span class="nc" id="L44">            return ResponseEntity.status(HttpStatus.OK).body(message);</span>
<span class="nc" id="L45">        } catch (Exception e) {</span>
<span class="nc" id="L46">            message = &quot;FAIL to upload &quot; + file.getOriginalFilename() + &quot;!&quot;;</span>
<span class="nc" id="L47">            System.out.println(ResponseEntity.status(HttpStatus.EXPECTATION_FAILED).body(message));</span>
<span class="nc" id="L48">            System.out.println(e.getStackTrace());</span>
<span class="nc" id="L49">            return ResponseEntity.status(HttpStatus.EXPECTATION_FAILED).body(message);</span>
        }
    }

    @RequestMapping(value = &quot;/getoption&quot;, method = RequestMethod.POST, headers = &quot;Accept=application/json&quot;)

    @CrossOrigin(origins = &quot;http://localhost:4200&quot;, allowedHeaders = &quot;*&quot;)
    @ResponseBody
    public ResponseEntity&lt;String&gt; getOptions(@RequestBody Map&lt;String, String&gt; payload){
<span class="nc" id="L58">        String message = &quot;ok&quot;;</span>
        try {

<span class="nc" id="L61">         System.out.println(payload.get(&quot;method&quot;));</span>
<span class="nc" id="L62">         System.out.println(payload.get(&quot;line&quot;));</span>
<span class="nc" id="L63">         System.out.println(payload.get(&quot;insturction&quot;));</span>
<span class="nc" id="L64">         System.out.println(payload.get(&quot;branch&quot;));</span>

<span class="nc" id="L66">            new Thread(new Runnable() {</span>
                @Override
                public void run() {
                    // code goes here.
<span class="nc" id="L70">                   runTest();</span>
<span class="nc" id="L71">                    readXml();</span>
                    //GetResult.status=&quot;complete&quot;;
<span class="nc" id="L73">                }</span>
<span class="nc" id="L74">            }).start();</span>

<span class="nc" id="L76">            return ResponseEntity.status(HttpStatus.OK).body(message);</span>

<span class="nc" id="L78">        } catch (Exception e) {</span>
<span class="nc" id="L79">            message = &quot;FAIL to get options&quot;;</span>
<span class="nc" id="L80">            System.out.println(ResponseEntity.status(HttpStatus.EXPECTATION_FAILED).body(message));</span>
<span class="nc" id="L81">            System.out.println(e.getStackTrace());</span>
<span class="nc" id="L82">            return ResponseEntity.status(HttpStatus.EXPECTATION_FAILED).body(message);</span>
        }
    }

public   void runTest(){
<span class="nc" id="L87">    ProcessBuilder processBuilder = new ProcessBuilder();</span>

<span class="nc" id="L89">    processBuilder.command(&quot;bash&quot;, &quot;-c&quot;, &quot;ls /home/cheikh/IdeaProjects/testing | mvn clean test&quot;);</span>


    try {

<span class="nc" id="L94">        Process process = processBuilder.start();</span>

<span class="nc" id="L96">        BufferedReader reader =</span>
<span class="nc" id="L97">                new BufferedReader(new InputStreamReader(process.getInputStream()));</span>

        String line;
<span class="nc bnc" id="L100" title="All 2 branches missed.">        while ((line = reader.readLine()) != null) {</span>
<span class="nc" id="L101">            System.out.println(line);</span>
        }

<span class="nc" id="L104">        int exitCode = process.waitFor();</span>
<span class="nc" id="L105">        System.out.println(&quot;\nExited with error code : &quot; + exitCode);</span>

<span class="nc" id="L107">    } catch (IOException e) {</span>
<span class="nc" id="L108">        e.printStackTrace();</span>
<span class="nc" id="L109">    } catch (InterruptedException e) {</span>
<span class="nc" id="L110">        e.printStackTrace();</span>
<span class="nc" id="L111">    }</span>


<span class="nc" id="L114">}</span>

public void readXml(){
    try
    {
//creating a constructor of file class and parsing an XML file

<span class="nc" id="L121">        File file = new File(getClass().getClassLoader().getResource(&quot;report/jacoco.xml&quot;).getFile());</span>
//an instance of factory that gives a document builder
<span class="nc" id="L123">        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span>
//an instance of builder to parse the specified xml file
<span class="nc" id="L125">        dbf.setValidating(false);</span>
<span class="nc" id="L126">        dbf.setFeature(&quot;http://apache.org/xml/features/nonvalidating/load-external-dtd&quot;, false);</span>
<span class="nc" id="L127">        DocumentBuilder db = dbf.newDocumentBuilder();</span>
<span class="nc" id="L128">        Document doc = db.parse(file);</span>
<span class="nc" id="L129">        doc.getDocumentElement().normalize();</span>
<span class="nc" id="L130">        System.out.println(&quot;Root element: &quot; + doc.getDocumentElement().getNodeName());</span>
<span class="nc" id="L131">        NodeList nodeList = doc.getElementsByTagName(&quot;class&quot;);</span>
// nodeList is not iterable, so we are using for loop
<span class="nc bnc" id="L133" title="All 2 branches missed.">        for (int itr = 0; itr &lt; nodeList.getLength(); itr++)</span>
        {
<span class="nc" id="L135">            Node node = nodeList.item(itr);</span>
<span class="nc" id="L136">            System.out.println(&quot;\nNode Name :&quot; + node.getNodeName());</span>

<span class="nc bnc" id="L138" title="All 2 branches missed.">            if (node.getNodeType() == Node.ELEMENT_NODE )</span>
            {
<span class="nc" id="L140">                System.out.println(&quot;inside getnodetype&quot;);</span>
<span class="nc bnc" id="L141" title="All 2 branches missed.">                if(node.getAttributes().getNamedItem(&quot;sourcefilename&quot;).equals(&quot;TestCircle&quot;)){</span>
<span class="nc" id="L142">                    Element eElement = (Element) node;</span>
<span class="nc bnc" id="L143" title="All 2 branches missed.">                    if(eElement.getChildNodes().item(9).getNodeName().equals(&quot;counter&quot;)){</span>

<span class="nc" id="L145">                        System.out.println(&quot;counter : &quot;+ eElement.getChildNodes().item(9).getAttributes().getNamedItem(&quot;INSTRUCTION&quot;));</span>

                    }
                }


            }
        }
    }
<span class="nc" id="L154">    catch (Exception e)</span>
    {
<span class="nc" id="L156">        e.printStackTrace();</span>

<span class="nc" id="L158">    }</span>
<span class="nc" id="L159">}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>