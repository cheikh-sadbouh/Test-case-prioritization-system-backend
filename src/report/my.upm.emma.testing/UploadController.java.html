<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>UploadController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">testing</a> &gt; <a href="index.source.html" class="el_package">my.upm.emma.testing</a> &gt; <span class="el_source">UploadController.java</span></div><h1>UploadController.java</h1><pre class="source lang-java linenums">package my.upm.emma.testing;

import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.*;
import java.util.stream.Collectors;
import java.util.stream.Stream;

import org.slf4j.ILoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.ClassPathResource;
import org.springframework.core.io.Resource;
import org.springframework.http.HttpHeaders;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.util.ResourceUtils;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;
import org.springframework.web.servlet.mvc.method.annotation.MvcUriComponentsBuilder;

import javax.xml.parsers.DocumentBuilderFactory;
import javax.xml.parsers.DocumentBuilder;
import org.w3c.dom.Document;
import org.w3c.dom.NodeList;
import org.w3c.dom.Node;
import org.w3c.dom.Element;
import java.io.File;
import javax.xml.parsers.DocumentBuilderFactory;


@Controller
<span class="nc" id="L36">public class UploadController {</span>

    @Autowired
    StorageService storageService;

<span class="nc" id="L41">    List&lt;String&gt; files = new ArrayList&lt;String&gt;();</span>


    @RequestMapping(
            value = (&quot;/post&quot;),
            headers = &quot;content-type=multipart/form-data&quot;,
            method = RequestMethod.POST)
    @CrossOrigin(origins = &quot;http://localhost:4200&quot;, allowedHeaders = &quot;*&quot;)
    @ResponseBody
    public ResponseEntity&lt;?&gt; handleFileUpload(@RequestParam(&quot;file&quot;) MultipartFile file) {
<span class="nc" id="L51">        String message = &quot;&quot;;</span>
        try {
<span class="nc" id="L53">            storageService.store(file);</span>
<span class="nc" id="L54">            files.add(file.getOriginalFilename());</span>

<span class="nc" id="L56">            message = &quot;You successfully uploaded &quot; + file.getOriginalFilename() + &quot;!&quot;;</span>
<span class="nc" id="L57">            return ResponseEntity.status(HttpStatus.OK).body(message);</span>
<span class="nc" id="L58">        } catch (Exception e) {</span>
<span class="nc" id="L59">            message = &quot;FAIL to upload &quot; + file.getOriginalFilename() + &quot;!&quot;;</span>
<span class="nc" id="L60">            System.out.println(ResponseEntity.status(HttpStatus.EXPECTATION_FAILED).body(message));</span>
<span class="nc" id="L61">            System.out.println(e.getStackTrace());</span>
<span class="nc" id="L62">            return ResponseEntity.status(HttpStatus.EXPECTATION_FAILED).body(message);</span>
        }
    }

    @RequestMapping(value = &quot;/getoption&quot;, method = RequestMethod.POST, headers = &quot;Accept=application/json&quot;)

    @CrossOrigin(origins = &quot;http://localhost:4200&quot;, allowedHeaders = &quot;*&quot;)
    @ResponseBody
    public ResponseEntity&lt;String&gt; getOptions(@RequestBody Map&lt;String, String&gt; payload){
<span class="nc" id="L71">        String message = &quot;ok&quot;;</span>
        try {

<span class="nc" id="L74">         System.out.println(payload.get(&quot;method&quot;));</span>
<span class="nc" id="L75">         System.out.println(payload.get(&quot;line&quot;));</span>
<span class="nc" id="L76">         System.out.println(payload.get(&quot;insturction&quot;));</span>
<span class="nc" id="L77">         System.out.println(payload.get(&quot;branch&quot;));</span>

<span class="nc" id="L79">            new Thread(new Runnable() {</span>
                @Override
                public void run() {
                    // code goes here.
<span class="nc" id="L83">                   runTest();</span>
<span class="nc" id="L84">                    readXml();</span>
                    //GetResult.status=&quot;complete&quot;;
<span class="nc" id="L86">                }</span>
<span class="nc" id="L87">            }).start();</span>

<span class="nc" id="L89">            return ResponseEntity.status(HttpStatus.OK).body(message);</span>

<span class="nc" id="L91">        } catch (Exception e) {</span>
<span class="nc" id="L92">            message = &quot;FAIL to get options&quot;;</span>
<span class="nc" id="L93">            System.out.println(ResponseEntity.status(HttpStatus.EXPECTATION_FAILED).body(message));</span>
<span class="nc" id="L94">            System.out.println(e.getStackTrace());</span>
<span class="nc" id="L95">            return ResponseEntity.status(HttpStatus.EXPECTATION_FAILED).body(message);</span>
        }
    }

public   void runTest(){
<span class="nc" id="L100">    ProcessBuilder processBuilder = new ProcessBuilder();</span>

<span class="nc" id="L102">    processBuilder.command(&quot;bash&quot;, &quot;-c&quot;, &quot;ls /home/cheikh/IdeaProjects/testing | mvn clean test&quot;);</span>


    try {

<span class="nc" id="L107">        Process process = processBuilder.start();</span>

<span class="nc" id="L109">        BufferedReader reader =</span>
<span class="nc" id="L110">                new BufferedReader(new InputStreamReader(process.getInputStream()));</span>

        String line;
<span class="nc bnc" id="L113" title="All 2 branches missed.">        while ((line = reader.readLine()) != null) {</span>
<span class="nc" id="L114">            System.out.println(line);</span>
        }

<span class="nc" id="L117">        int exitCode = process.waitFor();</span>
<span class="nc" id="L118">        System.out.println(&quot;\nExited with error code : &quot; + exitCode);</span>

<span class="nc" id="L120">    } catch (IOException e) {</span>
<span class="nc" id="L121">        e.printStackTrace();</span>
<span class="nc" id="L122">    } catch (InterruptedException e) {</span>
<span class="nc" id="L123">        e.printStackTrace();</span>
<span class="nc" id="L124">    }</span>


<span class="nc" id="L127">}</span>

public void readXml(){
    try
    {
//creating a constructor of file class and parsing an XML file

<span class="nc" id="L134">        File file = new ClassPathResource(</span>
<span class="nc" id="L135">                &quot;../resources/report/jacoco.xml&quot;).getFile();</span>
//an instance of factory that gives a document builder
<span class="nc" id="L137">        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();</span>
//an instance of builder to parse the specified xml file
<span class="nc" id="L139">        DocumentBuilder db = dbf.newDocumentBuilder();</span>
<span class="nc" id="L140">        Document doc = db.parse(file);</span>
<span class="nc" id="L141">        doc.getDocumentElement().normalize();</span>
<span class="nc" id="L142">        System.out.println(&quot;Root element: &quot; + doc.getDocumentElement().getNodeName());</span>
<span class="nc" id="L143">        NodeList nodeList = doc.getElementsByTagName(&quot;class&quot;);</span>
// nodeList is not iterable, so we are using for loop
<span class="nc bnc" id="L145" title="All 2 branches missed.">        for (int itr = 0; itr &lt; nodeList.getLength(); itr++)</span>
        {
<span class="nc" id="L147">            Node node = nodeList.item(itr);</span>
<span class="nc" id="L148">            System.out.println(&quot;\nNode Name :&quot; + node.getNodeName());</span>

<span class="nc bnc" id="L150" title="All 4 branches missed.">            if (node.getNodeType() == Node.ELEMENT_NODE &amp;&amp; node.getAttributes().getNamedItem(&quot;sourcefilename&quot;).equals(&quot;TestCircle&quot;))</span>
            {
<span class="nc" id="L152">                Element eElement = (Element) node;</span>
<span class="nc bnc" id="L153" title="All 2 branches missed.">                if(eElement.getChildNodes().item(9).getNodeName().equals(&quot;counter&quot;)){</span>

<span class="nc" id="L155">                    System.out.println(&quot;counter : &quot;+ eElement.getChildNodes().item(9).getAttributes().getNamedItem(&quot;INSTRUCTION&quot;));</span>

                }

            }
        }
    }
<span class="nc" id="L162">    catch (Exception e)</span>
    {
<span class="nc" id="L164">        e.printStackTrace();</span>
<span class="nc" id="L165">    }</span>
<span class="nc" id="L166">}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.3.201901230119</span></div></body></html>